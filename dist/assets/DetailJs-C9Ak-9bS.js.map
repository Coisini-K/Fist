{"version":3,"file":"DetailJs-C9Ak-9bS.js","sources":["../../src/components/Detail.js"],"sourcesContent":["/* 商品详情页js Detail.html */\r\nimport Reception from '../stores/reception.js';\r\nimport  '@/components/ShoppingCart/ShoppingCart.js';\r\nimport  '@/style/Detail.css';\r\n// import '@/components/index.js';\r\n// import '@/router/router.js';\r\n\r\n// 初始化图片库\r\nconst initializeGallery = (gallery, mainImageSrc) => {\r\n    const galleryImages = gallery.querySelectorAll('.mockup_img');\r\n    const usedIndices = new Set(); // 记录已使用的索引\r\n    const totalImages = 10; // 图片总数\r\n\r\n    galleryImages.forEach((img, index) => {\r\n        let randomIndex;\r\n        if (index === 0) {\r\n            img.src = mainImageSrc;\r\n            const mainImageIndex = parseInt(mainImageSrc.split('/').pop().split('.')[0]);\r\n            // console.log(mainImageIndex);\r\n            usedIndices.add(mainImageIndex); // 记录第一张图片的索引\r\n            // console.log(usedIndices);\r\n\r\n        } else {\r\n            do {\r\n                randomIndex = generateRandomNumber(1, totalImages);\r\n            } while (usedIndices.has(randomIndex));\r\n\r\n            usedIndices.add(randomIndex);\r\n            img.src = `./assets/images/Recommend/${randomIndex}.jpg`;\r\n            // console.log(img.src);\r\n        }\r\n\r\n        img.onclick = () => {\r\n            selectImage(index);\r\n            highlightCurrentImage(index);\r\n        };\r\n    });\r\n\r\n    // 初始高亮第一张图片\r\n    highlightCurrentImage(0);\r\n};\r\n\r\n// 选择图片\r\nconst selectImage = (index) => {\r\n    const mainImage = document.querySelector('.mockup_img');\r\n    const galleryImages = document.querySelectorAll('.td_box .mockup_img');\r\n    mainImage.src = galleryImages[index].src;\r\n    // currentIndex = index;\r\n};\r\n\r\n// 高亮当前选中的图片\r\nconst highlightCurrentImage = (index) => {\r\n    const galleryImages = document.querySelectorAll('.td_box .mockup_img');\r\n    galleryImages.forEach((img, idx) => {\r\n        if (idx === index) {\r\n            img.classList.add('highlighted'); // 添加高亮样式\r\n        } else {\r\n            img.classList.remove('highlighted'); // 移除高亮样式\r\n        }\r\n    });\r\n};\r\n\r\ndocument.addEventListener('DOMContentLoaded', function () {\r\n    // 添加监听器以处理“加入购物车”按钮点击\r\n    // 获取加入购物车按钮\r\n    const addToCartButton = document.querySelector('.addcart');\r\n    if (addToCartButton) {\r\n            addToCartButton.addEventListener('click', addToCart);\r\n        }\r\n    \r\n    const collectionButton = document.querySelector('.collection');\r\n    const bookmarkMessageContainer = document.getElementById('messageContainer');\r\n     // 添加监听器以处理“加入购物车”按钮点击\r\n    if (addToCartButton||collectionButton) {\r\n        addToCartButton.addEventListener('click', function (event) {\r\n                event.preventDefault();\r\n                showAndHideMessage(bookmarkMessageContainer, '已添加购物车');\r\n            });\r\n            collectionButton.addEventListener('click', function (event) {\r\n                event.preventDefault();\r\n               //  bookmarkMessageContainer.style.zIndex = 1;\r\n                showAndHideMessage(bookmarkMessageContainer, '已收藏');\r\n               //  bookmarkMessageContainer.style.zIndex = -1;\r\n            });\r\n        }\r\n\r\n    // 获取收藏按钮和消息容器\r\n    //  const collectionButton = document.querySelector('.collection');\r\n    //  const bookmarkMessageContainer = document.getElementById('messageContainer');\r\n \r\n    // // 添加监听器以处理“收藏”按钮点击\r\n    //  if (collectionButton) {\r\n    //      collectionButton.addEventListener('click', function (event) {\r\n    //          event.preventDefault();\r\n    //         //  bookmarkMessageContainer.style.zIndex = 1;\r\n    //          showAndHideMessage(bookmarkMessageContainer, '已收藏');\r\n    //         //  bookmarkMessageContainer.style.zIndex = -1;\r\n    //      });\r\n    //  }\r\n\r\n\r\n    const productData = Reception.getProductData();\r\n    if (!productData) {\r\n        console.error('No product data found.');\r\n        return;\r\n    }\r\n\r\n    // 填充产品图片\r\n    const productImage = document.querySelector('.mockup_img');\r\n    if (productImage) {\r\n        productImage.src = './' + productData.image;\r\n    }\r\n\r\n    // 填充产品标题\r\n    const productTitle = document.querySelector('.head_span');\r\n    if (productTitle) {\r\n        productTitle.textContent = productData.text;\r\n    }\r\n\r\n    // 填充产品价格\r\n    const productPrice = document.querySelector('.tr_two.Price');\r\n    if (productPrice) {\r\n        productPrice.textContent = productData.price;\r\n    }\r\n\r\n    // 填充火图标和随机数\r\n    const fireElement = document.querySelector('.tr_two.fire');\r\n    if (fireElement) {\r\n        const fireCount = 5; // 可以根据需要调整这个值\r\n        populateFireIconsAndRandomNumbers(fireElement, fireCount);\r\n    }\r\n\r\n    // 设置 tr_there 的随机数\r\n    const trThere = document.querySelector('.tr_there');\r\n    if (trThere) {\r\n        const maxStock = generateRandomNumber(100, 1000); // 调整范围以适应需求\r\n        trThere.textContent = `${maxStock} 件可售`;\r\n        trThere.dataset.maxStock = maxStock; // 存储最大库存数\r\n    }\r\n\r\n    // 初始化图片库\r\n    const gallery = document.querySelector('.td_box');\r\n    if (gallery) {\r\n        initializeGallery(gallery, productImage.src);\r\n    }\r\n\r\n    // 初始化数量输入框\r\n    const inputNumber = document.querySelector('.i_txt');\r\n    const defaultQuantity = productData.defaultQuantity || 1; // 获取默认数量，如果没有则默认为1\r\n    inputNumber.value = defaultQuantity;\r\n\r\n    if (inputNumber) {\r\n        inputNumber.addEventListener('input', function () {\r\n            const value = inputNumber.value.trim();\r\n            const maxStock = parseInt(trThere.dataset.maxStock);\r\n\r\n            if (isNaN(value) || value <= 0 || value > maxStock) {\r\n                inputNumber.value = 1;\r\n            } else {\r\n                updateTotalPrice(inputNumber.value);\r\n            }\r\n        });\r\n    }\r\n\r\n    // 初始化加减按钮\r\n    const decrementButton = document.querySelector('.decrement');\r\n    const incrementButton = document.querySelector('.increment');\r\n    if (decrementButton && incrementButton) {\r\n        decrementButton.addEventListener('click', function () {\r\n            const value = parseInt(inputNumber.value);\r\n            if (value > 1) {\r\n                inputNumber.value = value - 1;\r\n                updateTotalPrice(inputNumber.value);\r\n            }\r\n        });\r\n\r\n        incrementButton.addEventListener('click', function () {\r\n            const value = parseInt(inputNumber.value);\r\n            const maxStock = parseInt(trThere.dataset.maxStock);\r\n            if (value < maxStock) {\r\n                inputNumber.value = value + 1;\r\n                updateTotalPrice(inputNumber.value);\r\n            }\r\n        });\r\n    }\r\n\r\n    // 初始化图片切换按钮\r\n    const leftButton = document.querySelector('.left_button');\r\n    const rightButton = document.querySelector('.right_button');\r\n    let currentIndex = 0;\r\n\r\n    if (leftButton && rightButton) {\r\n        leftButton.addEventListener('click', () => switchImage(-1));\r\n        rightButton.addEventListener('click', () => switchImage(1));\r\n    }\r\n\r\n    // 初始化总价显示\r\n    const totalPriceElement = document.querySelector('.there input');\r\n    if (totalPriceElement) {\r\n        totalPriceElement.value = formatPrice(calculateTotalPrice(defaultQuantity, productData.price));\r\n    }\r\n\r\n    function switchImage(direction) {\r\n        const galleryImages = document.querySelectorAll('.td_box .mockup_img');\r\n        const totalImages = galleryImages.length;\r\n        currentIndex = (currentIndex + direction + totalImages) % totalImages;\r\n        const mainImage = document.querySelector('.mockup_img');\r\n        mainImage.src = galleryImages[currentIndex].src;\r\n        highlightCurrentImage(currentIndex);\r\n    }\r\n\r\n    function updateTotalPrice(quantity) {\r\n        const totalPrice = calculateTotalPrice(quantity, productData.price);\r\n        if (totalPriceElement) {\r\n            totalPriceElement.value = formatPrice(totalPrice);\r\n        }\r\n    }\r\n\r\n    function calculateTotalPrice(quantity, price) {\r\n        const numericPrice = parseFloat(price.replace('¥', '')); // 去掉价格符号\r\n        return quantity * numericPrice;\r\n    }\r\n\r\n    function formatPrice(price) {\r\n        return `¥ ${price.toFixed(2)}`; // 保留两位小数并添加价格符号\r\n    }\r\n});\r\n\r\n// 填充火图标和随机数到现有的 span 元素中\r\nconst populateFireIconsAndRandomNumbers = (element, count) => {\r\n    const fireIconSrc = './assets/images/Detail/fire-icon.png';\r\n    const spans = element.querySelectorAll('span');\r\n\r\n    // 生成火图标并插入到最前面\r\n    for (let i = 0; i < count; i++) {\r\n        const imgElement = document.createElement('img');\r\n        imgElement.src = fireIconSrc;\r\n        imgElement.alt = 'Fire Icon';\r\n        element.insertBefore(imgElement, element.firstChild);\r\n        if (i < count - 1) {\r\n            element.insertBefore(document.createTextNode(' '), element.firstChild); // 添加空格分隔\r\n        }\r\n    }\r\n\r\n    // 生成随机数并插入到 span 元素中\r\n    for (let j = 0;  j < spans.length; j++) {\r\n        const randomNumber = generateRandomNumber(100, 1000); // 调整范围以适应不同 span\r\n        spans[j].textContent = `${ randomNumber}`;\r\n    }\r\n};\r\n\r\n// 生成指定范围内的随机数\r\nconst generateRandomNumber = (min, max) => {\r\n    return Math.floor(Math.random() * (max - min + 1)) + min;\r\n};\r\n\r\n\r\n\r\nfunction addToCart(event) {\r\n    event.preventDefault();\r\n\r\n    // 获取产品详情数据\r\n    const productData = Reception.getProductData();\r\n    if (!productData) {\r\n        console.error('No product data found.');\r\n        return;\r\n    }\r\n\r\n    // 获取用户输入的数量\r\n    const inputNumber = document.querySelector('.i_txt');\r\n    const quantity = parseInt(inputNumber.value, 10);\r\n\r\n    if (isNaN(quantity) || quantity <= 0) {\r\n        console.error('Invalid quantity.');\r\n        return;\r\n    }\r\n\r\n    // 将数量添加到 productData 对象中\r\n    const updatedProductData = {\r\n        ...productData,\r\n        quantity: quantity\r\n    };\r\n\r\n    // 存储更新后的产品数据\r\n    Reception.storePromotionData(updatedProductData);\r\n}\r\n\r\n\r\nfunction showAndHideMessage(container, messageText) {\r\n    // 创建新的消息 div\r\n    const newMessageDiv = document.createElement('div');\r\n    newMessageDiv.className = 'message';\r\n    newMessageDiv.textContent = messageText;\r\n\r\n    // 获取当前容器中的所有消息元素\r\n    const existingMessages = Array.from(container.querySelectorAll('.message'));\r\n\r\n    // 将新消息添加到容器中\r\n    container.appendChild(newMessageDiv);\r\n\r\n    // 计算每个现有消息的新位置\r\n    existingMessages.forEach((msg, index) => {\r\n        setTimeout(() => {\r\n            msg.style.bottom = `${90 + (existingMessages.length - index) * (70 + 15)}px`; // 每个消息间隔为高度（60px）+ 间距（15px）\r\n            console.log('msg.style.bottom='+msg.style.bottom)\r\n        }, 10); // 延迟10毫秒以确保DOM更新完成\r\n    });\r\n\r\n    // 设置新消息的初始位置\r\n    newMessageDiv.style.bottom = '10%'; // 初始位置在视口下方\r\n\r\n    // 3秒后隐藏并移除消息\r\n    setTimeout(function () {\r\n        // 首先让消息透明度变为0\r\n        newMessageDiv.style.opacity = '0';\r\n\r\n        setTimeout(function () {\r\n            if (newMessageDiv.parentNode === container) {\r\n                container.removeChild(newMessageDiv); // 移除消息\r\n                console.log('消息已移除');\r\n            } else {\r\n                console.error('消息元素已经不在原来的容器中');\r\n            }\r\n        }, 500); // 等待过渡效果结束再移除元素\r\n    }, 3000); // 总共等待3秒\r\n}"],"names":["initializeGallery","gallery","mainImageSrc","galleryImages","usedIndices","totalImages","img","index","randomIndex","mainImageIndex","generateRandomNumber","selectImage","highlightCurrentImage","mainImage","idx","addToCartButton","addToCart","collectionButton","bookmarkMessageContainer","event","showAndHideMessage","productData","Reception","productImage","productTitle","productPrice","fireElement","populateFireIconsAndRandomNumbers","trThere","maxStock","inputNumber","defaultQuantity","value","updateTotalPrice","decrementButton","incrementButton","leftButton","rightButton","currentIndex","switchImage","totalPriceElement","formatPrice","calculateTotalPrice","direction","quantity","totalPrice","price","numericPrice","element","count","fireIconSrc","spans","i","imgElement","j","randomNumber","min","max","updatedProductData","container","messageText","newMessageDiv","existingMessages","msg"],"mappings":"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"}